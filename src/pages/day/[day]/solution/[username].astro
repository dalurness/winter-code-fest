---
import { getCollection } from "astro:content";
import LayoutNavbarLayout from "../../../../layouts/LayoutNavbar.astro";
import Question from "../../../../components/Question.astro";
import { Link } from "../../../../components/Link";

export async function getStaticPaths() {
  const blogEntries = await getCollection("days");
  let entries = blogEntries.flatMap(async (dayEntry) => {
    const solutions = await getCollection("communitySolutions", ({ id }) => {
      return id.startsWith(`${dayEntry.slug}/`);
    });
    return solutions.map((entry) => {
      let username = entry.slug.split("/")[1]!;

      return {
        params: { day: dayEntry.slug, username: username },
        props: { entry, dayEntry, username },
      };
    });
  });
  let pages = await Promise.all(entries);
  return pages.flatMap((p) => p);
}

const { entry, dayEntry, username } = Astro.props;
const day = Number(dayEntry.slug);
const { title } = dayEntry.data;
const { Content: QuestionContent } = await dayEntry.render();
const { Content } = await entry.render();
---

<LayoutNavbarLayout day={day} title={title}>
  <div class="mb-10">
    <h1>
      <Link href={`https://github.com/${username}`} target="_blank"
        >{username}</Link
      >'s Solution
    </h1>
    <!-- Add some spacing to all elements generated by markdown -->
    <div class="mt-10 *:mb-4">
      <Content />
    </div>
  </div>
  <Question day={day} title={title}>
    <QuestionContent />
  </Question>
</LayoutNavbarLayout>
